# Базы данных
**База данных** — совокупность данных, организованных в соответствии с концептуальной структурой, которая описывает
характеристики этих данных и взаимоотношения между ними.
Основная функция базы данных — предоставление единого хранилища для всей информации.
____
## Архитектурные модели
#### Централизованная
Система состоит из центрального компьютера и подключенных к нему терминалов.
Вся обработка данных выполняется в рамках этого единственного компьютера.
Пользовательские терминалы не обладают вычислительными мощностями и являются простым интерфейсом.
#### Файл — сервер
В архитектуре «файл-сервер»  средства организации и управления БД (в том числе СУБД) располагаются на машине клиента, а БД, представляющая собой набор специализированных файлов, – на машине-сервере.
Фактически, файловый сервер используется просто как общий жесткий диск.
#### Клиент – сервер
Данная архитектура предполагает, что СУБД находится на сервере, и только она имеет доступ к файлам БД.
На клиентских компьютерах работают пользовательские приложения и клиентские компоненты СУБД, осуществляющие взаимодействие с сервером. От клиента на сервер приходят запросы, которые обрабатываются СУБД, и результат отправляется обратно клиенту.
____
## СУБД
СУБД — это программа, с помощью которой осуществляется хранение, обработка, управление и поиск информации в базе данных.
#### Виды СУБД
- **Реляционные**. Отношения между данными являются реляционными, и данные хранятся в виде таблиц.
- **Объектно-ориентированные**. Данные представлены в виде объектов, их атрибутов, методов и классов.
- **NoSQL**
    - Иерархические. В иерархической модели данные организованы в древовидную структуру. Записи связаны друг с другом через связи в отношениях родитель-потомок.
    - Графовые. Данные хранятся в виде узлов, ребер и свойств. Узел представляет собой объект. Ребро представляет собой отношение, которое соединяет узлы. Свойства — это дополнительная информация, добавляемая к узлам.
    - Сетевые. Сетевые базы данных имеют иерархическую структуру, но в отличие от иерархических баз данных, где у одного дочернего элемента может быть только один родитель, сетевой узел может иметь отношения с несколькими объектами.
    - Документо-ориентированные. Каждый документ представляет данные в виде ключ-значение, связь с другими документами и мета-полями.
    - Ключ-значение. База данных на основе пар «ключ‑значение» хранит данные как совокупность пар «ключ‑значение», в которых ключ служит уникальным идентификатором.
    - Column-oriented. В таких системах данные хранятся в виде матрицы, строки и столбцы которой используются как ключи.
    - LDAP. Lightweight Directory Access Protocol — это открытый и кроссплатформенный протокол, используемый для аутентификации служб каталогов.
#### Реляционная модель
- Клиентска часть. Включает клиентское приложение и библиотеку LIBPQ, реализующую интерфейс связи с сервером. Библиотека LIBPQ отвечает за установление соединения с сервером и передачу SQL запросов.
- Серверная часть. Включает серверные процессы и контролирующий процесс-демон Postmaster. Postmaster авторизует и принимает запросы от клиентов. После того как клиент соединяется с сервером, процесс postmaster создает серверный процесс (используется связь один-к-одному), и дальше клиент работает уже с ним. На каждое соединение создается по серверному процессу, поэтому при большом числе соединений следует использовать пул (расширение pgbouncer).

Postmaster также запускает ряд служебных процессов, увидеть которые можно с помощью команды ps fax.
##### Процессы и память
В обще памяти находится:
- буферный кэш (большая часть общей памяти). Он нужен для ускорения работы с данными на диске.
- информация о блокировках 
- и многое другое, через нее же серверные процессы общаются друг с другом.

У каждого серверного процесса есть своя локальная память. В ней находится:
- кэш каталога (часто используемая информация о базе данных)
- планы запросов
- рабочее пространство для выполнения запросов
- и другое.

##### Буферный кэш
Используется для оптимизации скорости работы памяти и дисков. Буфер состоит из блоков данных и информации о них.
Размер блока обычно составляет 8 КБ, но может устанавливаться при сборке.
Буферный кэш защищен блокировками от одновременного доступа.

Любой блок, с которым работает СУБД, попадает в кэш. Часто используемые блоки остаются в кэше надолго, редко используемые — вытесняются и заменяются другими блоками.

Буфер, содержащий измененный блок, называется «грязным».
Процесс Background Writer постепенно записывает такие блоки на диск в фоновом режиме, это позволяет снизить нагрузку на диски и увеличить производительность.
Если Background Writer не успевает записать вытесняемый серверным процессом грязный буфер, то процесс записывает его сам. С точки зрения производительности этого лучше не допускать.

##### Кластер
Кластер баз данных - это набор баз, управляемых одним экземпляром работающего сервера.
После инициализации кластер будет содержать базу данных с именем postgres, она используется утилитами, пользователями и сторонними приложениями.

Базы данных логически делятся на одно или более табличных пространств. Табличное пространство — это логическая сущность, содержащая физические базы данных. Табличное пространство указывает расположение данных (каталог на файловой системе).
Оно может использоваться несколькими базами данных.

Объекты (таблицы и индексы) хранятся в файлах.
Каждый объект занимает один или несколько файлов внутри каталога табличного пространства. Кроме того, файлы разбиваются на части по 1 ГБ.
Необходимо учитывать влияние потенциально большого количества файлов на используемую файловую систему.

##### Транзакции. ACID
Транзакция объединяет последовательность действий в одну операцию «всё или ничего».
Промежуточные состояния внутри последовательности не видны другим транзакциям, и если что-то помешает успешно завершить транзакцию, ни один из результатов этих действий не сохранится в базе данных.
Транзакции должны удовлетворять требованиям **ACID**:
- атомарность (atomicity) означает, что все действия внутри транзакции рассматриваются как единое целое. При фиксации выполняются все операции, составляющие транзакцию, при откате — не выполняется ни одна.
- согласованность (consistency) Транзакция начинает работу в согласованном (целостном) состоянии и по окончании своей работы также оставляет данные согласованными. Каждая успешная транзакция по определению фиксирует только допустимые результаты
- изоляция (isolation). На результат работы транзакции не оказывают влияния другие, одновременно с ней выполняющиеся транзакции. Изоляция может иметь несколько различных уровней, в различной степени защищающих транзакции от внешних воздействий
- долговечность (durability). Подразумевает возможность восстановить базу данных после сбоя в согласованном состоянии. Если пришло подтверждение, что транзакция выполнена, то араантируется, что изменения не будут отменены из-за какого-либо сбоя.

## CAP
Теорема CAP (теорема Брюера) — эвристическое утверждение о том, что в любой реализации распределенных вычислений возможно обеспечить не более двух из трёх следующих свойств:
- Согласованность данных (consistency) — как только мы успешно записали данные в наше распределенное хранилище, любой клиент при запросе получит эти последние данные.
- Доступность (availability) — в любой момент клиент может получить данные из нашего хранилища или получить ответ об их отсутствии, если их никто еще не сохранял.
- Устойчивость к разделению (partition tolerance) — потеря сообщений между компонентами системы (возможно даже потеря всех сообщений) не влияет на работоспособность системы. Здесь очень важный момент: если какие-то компоненты выходят из строя, то это тоже подпадает под этот случай, так как можно считать, что данные компоненты просто теряют связь со всей остальной системой.

## PACELC
Расширение CAP-теоремы.
Добавляет понятие Latency — время, за которое клиент получит ответ и которое регулируется каким-либо уровнем согласованности
![PACELC](https://github.com/JulianP-P/KnowledgeBase/blob/main/img1.png)

В случае разделения сети (P) в распределённой системе необходимо выбирать между доступностью (A) и согласованностью (C) (согласно теореме CAP), но в любом случае, даже если система работает нормально в отсутствии разделения (E), нужно выбирать между задержками (L) и согласованностью (C)
